/*
 * @flow
 */

import React from 'react';
import styled from 'styled-components';
import reactMapboxGl, { Layer, Feature } from 'react-mapbox-gl';
import { List, Map } from 'immutable';

import mapMarker from '../../assets/images/map-marker.png';
import { MAPBOX_TOKEN } from '../../utils/constants/Constants';

type Props = {
  entities :List<Map<*, *>>
};

type State = {

};

const Wrapper = styled.div`
  display: flex;
  flex-direction: column;
  width: 100%;
  height: 100%;
`;

const MapComponent = reactMapboxGl({
  accessToken: MAPBOX_TOKEN
});

const POINTS = [
  [37.81728058, -122.45989418],
  [37.77084131, -122.49632332],
  [37.81705485, -122.35743892],
  [37.74775493, -122.47529395],
  [37.76999419, -122.49841985],
  [37.83660752, -122.38084095],
  [37.72379731, -122.38098936],
  [37.77642093, -122.50770533],
  [37.83687735, -122.45762623],
  [37.72841758, -122.39771015],
  [37.76999914, -122.48630195],
  [37.74959658, -122.3426946],
  [37.776956, -122.50434123],
  [37.78030845, -122.36552786],
  [37.7540397, -122.48202947],
  [37.76994431, -122.47601137],
  [37.84209667, -122.40238179],
  [37.75483587, -122.33484942],
  [37.76670692, -122.36104662],
  [37.8150073, -122.47841826],
  [37.79538885, -122.36102018],
  [37.72506614, -122.35744831],
  [37.8257782, -122.35561115],
  [37.71284305, -122.43833331],
  [37.79079134, -122.33741068],
  [37.76363426, -122.49004893],
  [37.73745688, -122.44678799],
  [37.81619671, -122.41532439],
  [37.78824396, -122.47930387],
  [37.75509123, -122.36977486],
  [37.76870115, -122.36426322],
  [37.78058233, -122.34607197],
  [37.82907917, -122.45406849],
  [37.70525031, -122.42402996],
  [37.8284885, -122.44219756],
  [37.7422416, -122.34287458],
  [37.78650533, -122.4988632],
  [37.80767348, -122.44105539],
  [37.73641008, -122.41376439],
  [37.74503505, -122.43295064],
  [37.83781938, -122.42910577],
  [37.83785647, -122.38918854],
  [37.72584432, -122.46287831],
  [37.80491865, -122.43377385],
  [37.84345675, -122.43028692],
  [37.82058325, -122.38214477],
  [37.80009233, -122.33475151],
  [37.83163447, -122.47197529],
  [37.77300484, -122.5085876],
  [37.8029736, -122.41959528],
  [37.79998732, -122.42745101],
  [37.75493815, -122.3630912],
  [37.79069062, -122.40919797],
  [37.83152659, -122.40551194],
  [37.81694998, -122.43815473],
  [37.79010359, -122.37682853],
  [37.73012667, -122.38433221],
  [37.80376848, -122.35772103],
  [37.8244619, -122.47845399],
  [37.8203831, -122.46404891],
  [37.75120875, -122.34986175],
  [37.7067649, -122.4431321],
  [37.79447128, -122.44119507],
  [37.72720956, -122.47013686],
  [37.75279779, -122.49386198],
  [37.78871879, -122.45893381],
  [37.74427396, -122.3511115],
  [37.71835801, -122.42419181],
  [37.71372199, -122.45356482],
  [37.77937341, -122.34362163],
  [37.78082967, -122.46125619],
  [37.71140764, -122.40583074],
  [37.77629262, -122.49271643],
  [37.76216131, -122.39168529],
  [37.79888679, -122.3861318],
  [37.75407496, -122.38523358],
  [37.74571413, -122.45671785],
  [37.78862165, -122.34280182],
  [37.79456892, -122.42070934],
  [37.7264645, -122.40705901],
  [37.76009572, -122.45049759],
  [37.76379589, -122.42948934],
  [37.71351827, -122.39342382],
  [37.83440602, -122.37488442],
  [37.76541899, -122.46379147],
  [37.83688652, -122.41197738],
  [37.73424775, -122.38625691],
  [37.82072081, -122.45580892],
  [37.79992735, -122.35346274],
  [37.80854701, -122.46355521],
  [37.73449485, -122.43806813],
  [37.75797096, -122.39060427],
  [37.82724647, -122.4754905],
  [37.72554694, -122.45928734],
  [37.82267565, -122.43585248],
  [37.78769625, -122.3432475],
  [37.83692537, -122.40185035],
  [37.82640144, -122.41884678],
  [37.80242966, -122.40735835],
  [37.77844387, -122.44886249]
].map(([lat, long]) => [long, lat]);

class SimpleMap extends React.Component<Props, State> {

  constructor(props :Props) {
    super(props);
    this.state = {

    };
  }

  getBounds = () => {
    let minX;
    let maxX;
    let minY;
    let maxY;

    POINTS.forEach((point) => {
      const [x, y] = point;
      if (!minX || x < minX) {
        minX = x;
      }
      if (!maxX || x > maxX) {
        maxX = x;
      }
      if (!minY || y < minY) {
        minY = y;
      }
      if (!maxY || y > maxY) {
        maxY = y;
      }
    });

    return [[minX, minY], [maxX, maxY]];
  }

  render() {
    const image = new Image(20, 30);
    image.src = mapMarker;
    const images = ['mapMarker', image];
    return (
      <Wrapper>
        <div>map!</div>
        <MapComponent
            style="mapbox://styles/mapbox/streets-v9"
            fitBounds={this.getBounds()}
            fitBoundsOptions={{ padding: 50 }}
            containerStyle={{
              height: '100%',
              width: '100%'
            }}>
          <Layer
              type="symbol"
              id="marker"
              images={images}
              layout={{ 'icon-image': 'mapMarker' }}>
            {POINTS.map(point => <Feature key={point} coordinates={point} />)}
          </Layer>
        </MapComponent>
      </Wrapper>
    );
  }
}

export default SimpleMap;
